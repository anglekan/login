<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"> 
    <meta http-equiv="Content-Security-Policy"> 
    <title>登录</title>
    <link rel="stylesheet" href="./css/index.css">
</head>
<body>
    <p id="notebook">在线笔记本</p>
    <div id="box">
        <div id="ti">
            <div>登录</div>
            <div><a href="./register.html" style="text-decoration: none; color: white;">注册</a></div>    
        </div>
           <hr>
        <div id="hang">id号：&nbsp;&nbsp;&nbsp;&nbsp;<input type="text" id="id"></div>
        <div id="hang">用户名：<input type="text" id="name"></div>
        <div id="hang">密码：&nbsp;&nbsp;&nbsp;&nbsp;<input type="password" id="password"></div>
        <button onclick="login()">登录</button>
    </div>
</body>
</html>
<script src="./js/md5.js"></script>
<script>
    let id = document.getElementById('id')
        names = document.getElementById('name')
        pwd = document.getElementById('password')
        flag = 0
    function login(){
        //读取数据，判断是否存在
        const myHeaders = new Headers()
        myHeaders.append("Content-Type", "application/json")
        let requestOptions = { // 里面不能有body
          method: "GET",  
          headers: myHeaders,
          redirect: "follow",
        }
        fetch(`https://db-api.amarea.cn/users`, requestOptions)
        .then(response => response.json())
        .then(data => {
            console.log('id.value=',id.value)
            if(id.value=='' || names.value=='' || pwd.value==''){
                console.log('111')
                alert('请输入正确信息！')
            }else{
                for(let i = 0;i<data.length;i++){
                if (data[i].id === id.value && data[i].name === names.value && ((data[i].password == pwd.value)||(data[i].password == md5(pwd.value)))) { 
                    // console.log('存在该用户，无需注册，请登录')
                    flag = 1
                  } else {
                    //throw new Error("用户名不存在")
                    console.log('该用户不存在，请注册或id、用户名、密码输入存在错误，请重新输入！') 
                  }
                }
                if(flag == 1){
                    //跳转到主页
                    // document.location.href='./index.html?user_name='+names.value
                    document.location.href='./index_1.html'
                    localStorage.setItem("username",names.value)
                }else{
                    alert('id、用户名、密码输入存在错误，请重新输入！若不存在账号，请注册！') 
                }
            }
         })
        .catch(err => console.log(err))  

    }
</script>
